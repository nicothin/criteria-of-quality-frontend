<!DOCTYPE html>
<html lang="ru" class="no-js">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <meta http-equiv="X-UA-Compatible" content="ie=edge">
  <title>Критерии верстки</title>
  <link rel="stylesheet" href="style.css">
  <script>
    // да-да, это ГЛОБАЛЬНАЯ переменная, я знаю что делаю
    var codeReviewGET = parseGETParameters();
    console.log(codeReviewGET);

    // Добавим на html флаг работающего JS
    document.documentElement.className = document.documentElement.className.replace('no-js', 'js');

    // По факту загрузки страницы — работаем
    document.addEventListener('DOMContentLoaded', function() {

      // Добавим на html флаг загрузки страницы
      document.documentElement.classList.add('dom-content-loaded');

      // Если пришел GET
      if (codeReviewGET) {

        // Добавим класс на html
        document.documentElement.classList.add('has-get');

        // Заполним общие поля формы
        var fieldReviewURL = document.getElementById('review-link');
        fieldReviewURL.value = location.href;
        // По фокусу на поле URL будем выделять в нем текст
        fieldReviewURL.addEventListener('focus', function() {
          this.select();
        });
        document.getElementById('review-author').value = decodeURI(codeReviewGET.auth).replace( /\+/g, ' ' );
        document.getElementById('review-url').value = decodeURIComponent(codeReviewGET.url);
        document.getElementById('review-msg').value = decodeURI(codeReviewGET.comm).replace( /\+/g, ' ' );

        // Пройдем по чекбоксам, расставим их, допишем классы
        checkboxes = document.querySelectorAll('input[type="checkbox"]');
        checkboxes.forEach(function(checkbox, i) {
          var checkName = checkbox.name;
          if(checkName && codeReviewGET[checkName]) {
            checkbox.checked = true;
          }
          // TODO: проверять родительскую группу этого чекбокса
        });

        // TODO: при постановке чекбокса снимать класс акцентирования, при снятии чекбокса — наоборот
        // TODO: при постановке или снятии чекбокса проверять его родительскую группу

        // TODO: вынести в функцияю проверку родительской группы, передавать функции группу
        // Если хоть один чекбокс в группе проставлен, отмечаем общий чекбокс
        // Если хоть все чекбоксы группы сняты, снимаем общий чекбокс

        // TODO: вынести в функцию подсчет процента соблюдённых обязательных критериев

      }

      // Обрабатываем клики на кнопках «Подробнее» (делегируем обработку на document)
      var root = document;
      root.addEventListener('click', function(event) {
        var moreButton = event.target;
        if( moreButton.attributes['data-js-pct'] ) {
          moreButton.closest(".panel").classList.toggle('panel--collapse');
        }
      });

    });

    // Парсит get.
    // Вернет объект или false
    function parseGETParameters() {
      var realGet = window.location.search;
      if(!realGet) return false;
      var result = {};
      var gets = realGet.replace(/&amp;/g, '&').substring(1).split('&');
      for (var i = 0; i < gets.length; i++) {
        var get = gets[i].split('=');
        result[get[0]] = typeof(get[1]) == 'undefined' ? '' : get[1];
      }
      return result;
    }

    // Вернет ближайшего родителя по CSS-селектору
    // var parent = child.closest(parentSelector)
    (function(e){
     e.closest = e.closest || function(css){
       var node = this;
       while (node) {
          if (node.matches(css)) return node;
          else node = node.parentElement;
       }
       return null;
     }
    })(Element.prototype);

  </script>
</head>
<body>

  <header class="page-header  container">
    <h1>Проверка вёрстки</h1>
    <p>Универсальная форма для код-ревью в ходе обучения вёрстке.</p>
  </header>

  <div class="container  no-js-msg">
    <div class="alert  alert--danger">
      <b>ВНИМАНИЕ!</b> Эта страница не работает с отключенным Javascript. <br>Включите javascript или воспользуйтесь <a href="https://www.youtube.com/watch?v=0E00Zuayv9Q">универсальной инструкцией от Косаки Даимао</a>.
    </div>
  </div>

  <div class="container  loading-page"  data-text="Загружается" style="display:none;">
    <svg class="" width="64" height="64" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 100 100" preserveAspectRatio="xMidYMid" class="uil-default">
      <path fill="none" class="bk" d="M0 0h100v100H0z"/>
      <rect x="46.5" y="40" width="7" height="20" rx="5" ry="5" fill="#00b2ff" transform="translate(0 -30)">
        <animate attributeName="opacity" from="1" to="0" dur="1s" begin="0s" repeatCount="indefinite"/>
      </rect>
      <rect x="46.5" y="40" width="7" height="20" rx="5" ry="5" fill="#00b2ff" transform="rotate(30 105.98 65)">
        <animate attributeName="opacity" from="1" to="0" dur="1s" begin="0.083s" repeatCount="indefinite"/>
      </rect>
      <rect x="46.5" y="40" width="7" height="20" rx="5" ry="5" fill="#00b2ff" transform="rotate(60 75.98 65)">
        <animate attributeName="opacity" from="1" to="0" dur="1s" begin="0.16s" repeatCount="indefinite"/>
      </rect>
      <rect x="46.5" y="40" width="7" height="20" rx="5" ry="5" fill="#00b2ff" transform="rotate(90 65 65)">
        <animate attributeName="opacity" from="1" to="0" dur="1s" begin="0.25s" repeatCount="indefinite"/>
      </rect>
      <rect x="46.5" y="40" width="7" height="20" rx="5" ry="5" fill="#00b2ff" transform="rotate(120 58.66 65)">
        <animate attributeName="opacity" from="1" to="0" dur="1s" begin="0.33s" repeatCount="indefinite"/>
      </rect>
      <rect x="46.5" y="40" width="7" height="20" rx="5" ry="5" fill="#00b2ff" transform="rotate(150 54.02 65)">
        <animate attributeName="opacity" from="1" to="0" dur="1s" begin="0.416s" repeatCount="indefinite"/>
      </rect>
      <rect x="46.5" y="40" width="7" height="20" rx="5" ry="5" fill="#00b2ff" transform="rotate(180 50 65)">
        <animate attributeName="opacity" from="1" to="0" dur="1s" begin="0.5s" repeatCount="indefinite"/>
      </rect>
      <rect x="46.5" y="40" width="7" height="20" rx="5" ry="5" fill="#00b2ff" transform="rotate(-150 45.98 65)">
        <animate attributeName="opacity" from="1" to="0" dur="1s" begin="0.583s" repeatCount="indefinite"/>
      </rect>
      <rect x="46.5" y="40" width="7" height="20" rx="5" ry="5" fill="#00b2ff" transform="rotate(-120 41.34 65)">
        <animate attributeName="opacity" from="1" to="0" dur="1s" begin="0.6s" repeatCount="indefinite"/>
      </rect>
      <rect x="46.5" y="40" width="7" height="20" rx="5" ry="5" fill="#00b2ff" transform="rotate(-90 35 65)">
        <animate attributeName="opacity" from="1" to="0" dur="1s" begin="0.75s" repeatCount="indefinite"/>
      </rect>
      <rect x="46.5" y="40" width="7" height="20" rx="5" ry="5" fill="#00b2ff" transform="rotate(-60 24.02 65)">
        <animate attributeName="opacity" from="1" to="0" dur="1s" begin="0.833s" repeatCount="indefinite"/>
      </rect>
      <rect x="46.5" y="40" width="7" height="20" rx="5" ry="5" fill="#00b2ff" transform="rotate(-30 -5.98 65)">
        <animate attributeName="opacity" from="1" to="0" dur="1s" begin="0.916s" repeatCount="indefinite"/>
      </rect>
    </svg>
  </div>

  <form class="container  main-content" action="" style="display:none;">

    <section class="panel  about">
      <header class="panel__header">
        <h2 class="panel__title">Об этом код-ревью</h2>
      </header>
      <div class="panel__body">
        <div id="mandatory-progress-bar" class="progress__container" data-text="Обязательные критерии:" data-percent="0%">
          <span class="progress__bar  progress__bar--mandatory" style="width:0%;"></span>
        </div>
        <div id="optional-progress-bar" class="progress__container" data-text="Необязательные критерии:" data-percent="90%" style="display: none;">
          <span class="progress__bar  progress__bar--optional" style="width:90%;"></span>
        </div>
        <div class="pseudoform">
          <div class="form-field  form-review-link">
            <label class="form-field__label">
              <span class="form-field__name">Ссылка на этот код-ревью</span>
              <textarea id="review-link" class="form-field__text-input" rows="3"></textarea>
            </label>
          </div>
          <div class="row">
            <div class="col-sm-6  col-md-4">
              <div class="form-field">
                <label class="form-field__label">
                  <span class="form-field__name">Автор</span>
                  <input id="review-author" class="form-field__text-input" type="text" value="Анонимус" name="auth">
                </label>
              </div>
            </div>
            <div class="col-sm-6  col-md-8">
              <div class="form-field">
                <label class="form-field__label">
                  <span class="form-field__name">Проверяемый URL</span>
                  <input id="review-url" class="form-field__text-input" type="url" placeholder="https://github.com..." name="url">
                </label>
              </div>
            </div>
          </div>
          <div class="form-field">
            <label class="form-field__label">
              <span class="form-field__name">Сообщение, прикрепленное к код-ревью. Не более 812 символов.</span>
              <textarea id="review-msg" class="form-field__text-input" rows="6" placeholder="На что обратить особое внимание, какие навыки прокачивать." maxlength="812" name="comm"></textarea>
            </label>
          </div>
        </div>
      </div>
    </section>

    <section class="check-section" data-js-check-section>

      <label class="check-section__heading">
        <input class="check-section__heading-checkbox" type="checkbox" name="r0">
        <h2 class="check-section__heading-text">Секция правилСекция правилСекция правилСекция правилСекция правилСекция правилСекция правилСекция правил</h2>
      </label>

      <section class="panel  panel--collapse  check-section__item">
        <header class="panel__header">
          <label class="panel__title">
            <input class="panel__checkbox" type="checkbox" name="r1">
            <h3 class="panel__title-text">Какое-то правило</h3>
          </label>
          <span class="panel__title-btn-wrap"><button type="button" class="btn  check-section__btn" data-js-pct>Подробнее</button></span>
        </header>
        <div class="panel__body">
          <p>111</p>
        </div>
      </section>

      <section class="panel  panel--accent  check-section__item">
        <header class="panel__header">
          <label class="panel__title">
            <input class="panel__checkbox" type="checkbox" name="r2">
            <h3 class="panel__title-text">Какое-то правилоКакое-то правилоКакое-то правилоКакое-то правилоКакое-то правилоКакое-то правилоКакое-то правилоКакое-то правилоКакое-то правилоКакое-то правилоКакое-то правилоКакое-то правилоКакое-то правилоКакое-то правилоКакое-то правилоКакое-то правилоКакое-то правилоКакое-то правило</h3>
          </label>
          <span class="panel__title-btn-wrap"><button type="button" class="btn  check-section__btn" data-js-pct>Подробнее</button></span>
        </header>
        <div class="panel__body">
          <p>Какое-то пояснение</p>
          <pre>
            <code>&lt;div class=&quot;foo&quot;&gt;</code>
            <code>  &lt;div class=&quot;bar&quot;&gt;&lt;/div&gt;  &lt;div class=&quot;bar&quot;&gt;&lt;/div&gt;  &lt;div class=&quot;bar&quot;&gt;&lt;/div&gt;  &lt;div class=&quot;bar&quot;&gt;&lt;/div&gt;  &lt;div class=&quot;bar&quot;&gt;&lt;/div&gt;  &lt;div class=&quot;bar&quot;&gt;&lt;/div&gt;  &lt;div class=&quot;bar&quot;&gt;&lt;/div&gt;</code>
            <code>&lt;/div&gt;</code>
          </pre>
        </div>
      </section>

    </section>

    <section class="check-section" data-js-check-section>

      <label class="check-section__heading">
        <input class="check-section__heading-checkbox" type="checkbox" name="c0">
        <h2 class="check-section__heading-text">Секция правил</h2>
      </label>

      <section class="panel  panel--collapse  check-section__item">
        <header class="panel__header">
          <label class="panel__title">
            <input class="panel__checkbox" type="checkbox" name="c1">
            <h3 class="panel__title-text">Какое-то правило</h3>
          </label>
          <span class="panel__title-btn-wrap"><button type="button" class="btn  check-section__btn" data-js-pct>Подробнее</button></span>
        </header>
        <div class="panel__body">
          <p>111</p>
        </div>
      </section>

      <section class="panel  panel--accent  check-section__item">
        <header class="panel__header">
          <label class="panel__title">
            <input class="panel__checkbox" type="checkbox" name="c2">
            <h3 class="panel__title-text">Какое-то правило</h3>
          </label>
          <span class="panel__title-btn-wrap"><button type="button" class="btn  check-section__btn" data-js-pct>Подробнее</button></span>
        </header>
        <div class="panel__body">
          <p>Какое-то пояснение</p>
          <pre>
            <code>&lt;div class=&quot;foo&quot;&gt;</code>
            <code>  &lt;div class=&quot;bar&quot;&gt;&lt;/div&gt;</code>
            <code>&lt;/div&gt;</code>
          </pre>
        </div>
      </section>

    </section>

    <div class="main-nav">
      <div class="container  main-nav__inner">
        <ul class="main-nav__list">
          <li><a href="https://github.com/nicothin/criteria-of-quality-frontend">Репозиторий проекта</a></li>
        </ul>
        <button class="btn  main-nav__send-btn">Готово</button>
      </div>
    </div>

  </form>

  <footer class="page-footer  container">
    <p>© Николай Громов</p>
  </footer>

</body>
</html>
